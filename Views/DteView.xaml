<UserControl
    x:Class="VisorDTE.Views.DteView"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:models="using:VisorDTE.Models"
    mc:Ignorable="d">

    <UserControl.Resources>
        <Style x:Key="CopyButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="4,0,0,0"/>
            <Setter Property="VerticalAlignment" Value="Center"/>

            <Setter Property="ContentTemplate">
                <Setter.Value>
                    <DataTemplate>
                        <FontIcon FontFamily="Segoe Fluent Icons" Glyph="&#xE8C8;" FontSize="12"/>
                    </DataTemplate>
                </Setter.Value>
            </Setter>
        </Style>
    </UserControl.Resources>

    <Border BorderBrush="{ThemeResource SystemControlForegroundBaseMediumBrush}" BorderThickness="1" Padding="48" Margin="24" Background="{ThemeResource ApplicationPageBackgroundThemeBrush}" MaxWidth="816">
        <Grid RowDefinitions="Auto,Auto,Auto,*,Auto" Visibility="{Binding Converter={StaticResource NullToVisibilityConverter}}">

            <VisualStateManager.VisualStateGroups>
                <VisualStateGroup>
                    <VisualState x:Name="WideLayout">
                        <VisualState.StateTriggers>
                            <AdaptiveTrigger MinWindowWidth="720" />
                        </VisualState.StateTriggers>
                    </VisualState>
                    <VisualState x:Name="NarrowLayout">
                        <VisualState.StateTriggers>
                            <AdaptiveTrigger MinWindowWidth="0" />
                        </VisualState.StateTriggers>
                        <VisualState.Setters>
                            <Setter Target="EmisorReceptorGrid.ColumnDefinitions" Value="*"/>
                            <Setter Target="ReceptorPanel.(Grid.Column)" Value="0"/>
                            <Setter Target="ReceptorPanel.(Grid.Row)" Value="1"/>
                            <Setter Target="ReceptorPanel.Margin" Value="0,24,0,0"/>
                        </VisualState.Setters>
                    </VisualState>
                </VisualStateGroup>
            </VisualStateManager.VisualStateGroups>

            <Grid Grid.Row="0" Margin="0,0,0,24">
                <StackPanel>
                    <TextBlock Text="{Binding Dte.Emisor.NombreComercial, FallbackValue='Nombre Comercial'}" FontSize="28" FontWeight="SemiBold"/>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{Binding Dte.Identificacion.NumeroControl}" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" FontSize="12" VerticalAlignment="Center"/>
                        <Button Style="{StaticResource CopyButtonStyle}" 
                                Command="{Binding CopyToClipboardCommand}" 
                                CommandParameter="{Binding Dte.Identificacion.NumeroControl}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{Binding Dte.Identificacion.CodigoGeneracion}" Foreground="{ThemeResource SystemControlForegroundBaseMediumBrush}" FontSize="12" VerticalAlignment="Center"/>
                        <Button Style="{StaticResource CopyButtonStyle}" 
                                Command="{Binding CopyToClipboardCommand}" 
                                CommandParameter="{Binding Dte.Identificacion.CodigoGeneracion}"/>
                    </StackPanel>
                </StackPanel>
                <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" Spacing="4">
                    <Border Padding="8,4" Background="{ThemeResource SystemAccentColor}" CornerRadius="4">
                        <TextBlock Text="{Binding TipoDteDescripcion}" HorizontalAlignment="Right" FontWeight="Bold" Foreground="White"/>
                    </Border>
                    <TextBlock Text="{Binding Dte.Identificacion.FecEmi}" HorizontalAlignment="Right"/>
                    <TextBlock Text="{Binding Dte.Identificacion.HorEmi}" HorizontalAlignment="Right"/>
                </StackPanel>
            </Grid>

            <Rectangle Grid.Row="1" Height="1" Fill="{ThemeResource SystemControlForegroundBaseMediumBrush}" Margin="0,10"/>

            <Grid x:Name="EmisorReceptorGrid" Grid.Row="2" Margin="0,24" ColumnDefinitions="*,24,*" RowDefinitions="Auto,Auto">
                <StackPanel Grid.Row="0" Grid.Column="0" Spacing="2">
                    <TextBlock Text="EMISOR" FontWeight="Bold" Margin="0,0,0,8"/>
                    <TextBlock Text="{Binding Dte.Emisor.Nombre}" FontWeight="SemiBold" TextWrapping="Wrap"/>
                    <TextBlock Text="{Binding Dte.Emisor.NombreComercial}" Foreground="Gray" FontStyle="Italic"/>
                    <TextBlock Text="{Binding EmisorDireccionCompleta}" TextWrapping="Wrap" Margin="0,4,0,0"/>
                    <TextBlock Text="{Binding Dte.Emisor.DescActividad}" TextWrapping="Wrap" Margin="0,8,0,0" FontSize="11" FontStyle="Italic"/>
                    <TextBlock Text="{Binding Dte.Emisor.Correo}" Margin="0,8,0,0"/>
                    <TextBlock Text="{Binding Dte.Emisor.Telefono}"/>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{Binding Dte.Emisor.Nit, ConverterParameter='NIT: {0}', Converter={StaticResource StringFormatConverter}}" VerticalAlignment="Center"/>
                        <Button Style="{StaticResource CopyButtonStyle}" Command="{Binding CopyToClipboardCommand}" CommandParameter="{Binding Dte.Emisor.Nit}"/>
                    </StackPanel>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{Binding Dte.Emisor.Nrc, ConverterParameter='NRC: {0}', Converter={StaticResource StringFormatConverter}}" VerticalAlignment="Center"/>
                        <Button Style="{StaticResource CopyButtonStyle}" Command="{Binding CopyToClipboardCommand}" CommandParameter="{Binding Dte.Emisor.Nrc}"/>
                    </StackPanel>
                </StackPanel>

                <StackPanel x:Name="ReceptorPanel" Grid.Row="0" Grid.Column="2" Spacing="2">
                    <TextBlock Text="RECEPTOR" FontWeight="Bold" Margin="0,0,0,8"/>
                    <StackPanel Orientation="Horizontal" Spacing="4">
                        <TextBlock Text="{Binding Dte.Receptor.Nombre}" FontWeight="SemiBold" TextWrapping="Wrap"/>
                        <Button Style="{StaticResource CopyButtonStyle}" Command="{Binding CopyToClipboardCommand}" CommandParameter="{Binding Dte.Receptor.Nombre}"/>
                    </StackPanel>
                    <TextBlock Text="{Binding ReceptorDireccionCompleta}" TextWrapping="Wrap" Margin="0,4,0,0"/>
                    <StackPanel Orientation="Horizontal" Spacing="4" Margin="0,8,0,0">
                        <TextBlock Text="{Binding Dte.Receptor.Correo}"/>
                        <Button Style="{StaticResource CopyButtonStyle}" Command="{Binding CopyToClipboardCommand}" CommandParameter="{Binding Dte.Receptor.Correo}"/>
                    </StackPanel>
                    <TextBlock Text="{Binding Dte.Receptor.Telefono}"/>
                </StackPanel>
            </Grid>

            <ListView Grid.Row="3" Margin="0,0,0,24" ItemsSource="{Binding Dte.CuerpoDocumento}" SelectionMode="None">
                <ListView.HeaderTemplate>
                    <DataTemplate>
                        <Grid Padding="12,8" Background="{ThemeResource SystemControlBackgroundBaseLowBrush}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="90"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="Cant." FontWeight="Bold"/>
                            <TextBlock Grid.Column="1" Text="DescripciÃ³n" FontWeight="Bold"/>
                            <TextBlock Grid.Column="2" Text="P. Unitario" FontWeight="Bold" HorizontalAlignment="Right"/>
                            <TextBlock Grid.Column="3" Text="Descuento" FontWeight="Bold" HorizontalAlignment="Right"/>
                            <TextBlock Grid.Column="4" Text="Gravado" FontWeight="Bold" HorizontalAlignment="Right"/>
                        </Grid>
                    </DataTemplate>
                </ListView.HeaderTemplate>
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="models:CuerpoDocumento">
                        <Grid Padding="12,4">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="40"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="90"/>
                                <ColumnDefinition Width="90"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="{Binding Cantidad}"/>
                            <TextBlock Grid.Column="1" Text="{Binding Descripcion}" TextWrapping="Wrap"/>
                            <TextBlock Grid.Column="2" Text="{Binding PrecioUni, Converter={StaticResource CurrencyFormatConverter}}" HorizontalAlignment="Right"/>
                            <TextBlock Grid.Column="3" Text="{Binding MontoDescu, Converter={StaticResource CurrencyFormatConverter}}" HorizontalAlignment="Right"/>
                            <TextBlock Grid.Column="4" Text="{Binding VentaGravada, Converter={StaticResource CurrencyFormatConverter}}" HorizontalAlignment="Right"/>
                        </Grid>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <Grid Grid.Row="4" ColumnDefinitions="*,Auto">
                <StackPanel Grid.Column="0" VerticalAlignment="Bottom" MaxWidth="400" Spacing="4">
                    <TextBlock Text="{Binding Dte.Resumen.TotalLetras}" FontStyle="Italic" TextWrapping="Wrap"/>
                    <TextBlock Text="{Binding CondicionOperacionDescripcion}" FontWeight="SemiBold"/>
                    <TextBlock Text="{Binding Dte.Extension.Observaciones, FallbackValue=''}" FontSize="11" FontStyle="Italic" Foreground="Gray" TextWrapping="Wrap"/>
                </StackPanel>

                <Grid Grid.Column="1" MinWidth="280">
                    <Grid.RowDefinitions>
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                        <RowDefinition Height="Auto" />
                    </Grid.RowDefinitions>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*" />
                        <ColumnDefinition Width="Auto" />
                    </Grid.ColumnDefinitions>

                    <TextBlock Grid.Row="0" Grid.Column="0" Text="Subtotal:" HorizontalAlignment="Right" Margin="0,0,12,0"/>
                    <TextBlock Grid.Row="0" Grid.Column="1" Text="{Binding Dte.Resumen.SubTotal, Converter={StaticResource CurrencyFormatConverter}}" HorizontalAlignment="Right" MinWidth="90"/>

                    <TextBlock Grid.Row="1" Grid.Column="0" Text="Descuentos:" HorizontalAlignment="Right" Margin="0,0,12,0"/>
                    <TextBlock Grid.Row="1" Grid.Column="1" Text="{Binding Dte.Resumen.TotalDescu, Converter={StaticResource CurrencyFormatConverter}}" HorizontalAlignment="Right"/>

                    <ItemsControl Grid.Row="2" Grid.ColumnSpan="2" ItemsSource="{Binding Dte.Resumen.Tributos}" Margin="0,4,0,0">
                        <ItemsControl.ItemTemplate>
                            <DataTemplate x:DataType="models:TributoResumen">
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="*" />
                                        <ColumnDefinition Width="Auto" />
                                    </Grid.ColumnDefinitions>
                                    <TextBlock Grid.Column="0" Text="{Binding Descripcion}" HorizontalAlignment="Right" Margin="0,0,12,0" Foreground="Gray" TextWrapping="Wrap"/>
                                    <TextBlock Grid.Column="1" Text="{Binding Valor, Converter={StaticResource CurrencyFormatConverter}}" HorizontalAlignment="Right" MinWidth="90" Foreground="Gray"/>
                                </Grid>
                            </DataTemplate>
                        </ItemsControl.ItemTemplate>
                    </ItemsControl>

                    <StackPanel Grid.Row="3" Grid.ColumnSpan="2" Margin="0,8">
                        <Rectangle Height="1" Fill="{ThemeResource SystemControlForegroundBaseMediumBrush}"/>
                        <Grid Margin="0,8,0,0">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="*" />
                                <ColumnDefinition Width="Auto" />
                            </Grid.ColumnDefinitions>
                            <TextBlock Grid.Column="0" Text="TOTAL A PAGAR:" HorizontalAlignment="Right" Margin="0,0,12,0" FontWeight="Bold" FontSize="16" VerticalAlignment="Center"/>
                            <TextBlock Grid.Column="1" Text="{Binding Dte.Resumen.TotalPagar, Converter={StaticResource CurrencyFormatConverter}}" HorizontalAlignment="Right" MinWidth="90" FontWeight="Bold" FontSize="16"/>
                        </Grid>
                    </StackPanel>
                </Grid>
            </Grid>
        </Grid>
    </Border>
</UserControl>