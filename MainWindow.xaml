<Window
    x:Class="VisorDTE.MainWindow"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:views="using:VisorDTE.Views"
    xmlns:models="using:VisorDTE.Models"
    xmlns:viewmodels="using:VisorDTE.ViewModels"
    mc:Ignorable="d">

    <Grid x:Name="RootGrid" DataContext="{x:Bind ViewModel, Mode=OneWay}">

        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="*"/>
            <ColumnDefinition Width="Auto"/>
        </Grid.ColumnDefinitions>

        <Grid Grid.Column="0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <CommandBar Grid.Row="0" DefaultLabelPosition="Right" Background="Transparent">
                <AppBarButton Icon="OpenFile" Label="Abrir DTE" Command="{Binding OpenFilesCommand}"/>
                <AppBarButton Icon="Save" Label="Exportar a PDF" Command="{Binding ExportToPdfCommand}"/>
                <AppBarSeparator/>

                <AppBarButton Icon="Find" Label="{Binding ToggleInspectorLabel, Mode=OneWay}" Command="{Binding ToggleInspectorCommand}"/>

                <CommandBar.SecondaryCommands>
                    <AppBarButton Icon="Help" Label="Acerca de..." Command="{Binding ShowAboutDialogCommand}"/>
                </CommandBar.SecondaryCommands>
                <CommandBar.Content>
                    <AutoSuggestBox QueryIcon="Find" PlaceholderText="Buscar por NÃºmero de Control..." 
                                    Text="{Binding SearchQuery, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                    VerticalAlignment="Center"
                                    MinWidth="300"/>
                </CommandBar.Content>
            </CommandBar>

            <ListView Grid.Row="1" 
                      ItemsSource="{Binding DteViewModels}" 
                      SelectedItem="{Binding SelectedDte, Mode=TwoWay}"
                      Margin="12,0,12,0">
                <ListView.ItemTemplate>
                    <DataTemplate x:DataType="viewmodels:DTEViewModel">
                        <views:DteView/>
                    </DataTemplate>
                </ListView.ItemTemplate>
            </ListView>

            <Border Grid.Row="2" BorderThickness="0,1,0,0" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}">
                <TextBlock Text="{Binding StatusText, Mode=OneWay}" Margin="12,8" Foreground="Gray"/>
            </Border>
        </Grid>

        <Grid Grid.Column="1" 
              Width="400"
              Visibility="{Binding IsInspectorVisible, Mode=OneWay, Converter={StaticResource BoolToVisibilityConverter}}"
              Background="{ThemeResource SystemControlBackgroundBaseLowBrush}"
              BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}" 
              BorderThickness="1,0,0,0">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <TextBlock Grid.Row="0" Text="Inspector de JSON" FontSize="16" Margin="12"/>

            <ScrollViewer Grid.Row="1" Padding="12,0">
                <TreeView ItemsSource="{Binding JsonTreeNodes}">
                    <TreeView.ItemTemplate>
                        <DataTemplate x:DataType="models:JsonPropertyNode">
                            <TreeViewItem ItemsSource="{Binding Children}" IsExpanded="{Binding IsExpanded, Mode=TwoWay}">
                                <StackPanel Orientation="Horizontal" Spacing="8">
                                    <TextBlock>
                                        <Run Text="{Binding PropertyName}" FontWeight="SemiBold"/>
                                        <Run Text="{Binding Value}" Foreground="Gray"/>
                                    </TextBlock>
                                    <Button Content="ðŸ“‹" 
                                            ToolTipService.ToolTip="Copiar valor"
                                            Padding="4,0" 
                                            VerticalAlignment="Center" 
                                            Visibility="{Binding Value, Converter={StaticResource NullToVisibilityConverter}}"
                                            Command="{Binding DataContext.CopyToClipboardCommand, ElementName=RootGrid}"
                                            CommandParameter="{Binding Value}"/>
                                </StackPanel>
                            </TreeViewItem>
                        </DataTemplate>
                    </TreeView.ItemTemplate>
                </TreeView>
            </ScrollViewer>

            <StackPanel Grid.Row="2" Orientation="Horizontal" Spacing="8" Padding="12" BorderThickness="0,1,0,0" BorderBrush="{ThemeResource SystemControlForegroundBaseLowBrush}">
                <Button Content="Expandir Todo" Command="{Binding ExpandAllCommand}"/>
                <Button Content="Colapsar Todo" Command="{Binding CollapseAllCommand}"/>
            </StackPanel>
        </Grid>
    </Grid>
</Window>